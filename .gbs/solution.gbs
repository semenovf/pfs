solution "pfs-mpl"
    configurations { "debug", "release" }
    platforms { "unix32", "unix64" }

    flags       { "FatalWarnings" }
    cppdialect  "C++11"
    targetdir   "../../.build"
    includedirs { "../include" }
    libdirs     { "../../.build" }
    defines     { }
    links       { "dl", "m" }

qt5_core_lib = os.findlib("Qt5Core")
qt4_core_lib = os.findlib("QtCore")

if qt5_core_lib then
    print("Qt5 library found at " .. qt5_core_lib)
    defines { "PFS_HAVE_QT",  "PFS_HAVE_QT5" }
end

if qt4_core_lib then
    print("Qt4 library found at " .. qt4_core_lib)
    defines { "PFS_HAVE_QT", "PFS_HAVE_QT4" }
end

if qt5_core_lib then
    require("../../.gbs/qt5_enable")
elseif qt4_core_lib then
    require("../../.gbs/qt4_enable")
end

if qt5_core_lib or qt4_core_lib then
    --Available modules:
    --    core, gui, multimedia, network, opengl, positioning, printsupport,
    --    qml, quick, sensors, sql, svg, testlib, websockets, widgets, xml
    --
    qtmodules     { "core" }
end

configuration "debug"
    symbols      "On"
    defines      { "DEBUG" }
    targetsuffix "-d"

configuration "release"
    defines     { "NDEBUG" }


filter "action:gmake"
    buildoptions { "-Wno-long-long", "-pedantic", "-fPIC" }

filter { "release", "action:gmake" }
    buildoptions { "-Wunused" }

filter { "debug", "action:gmake" }
    buildoptions { "-ftemplate-backtrace-limit=0" }
    linkoptions  { "-rdynamic" }

filter "platforms:unix*"
    PTHREAD_LIB = os.findlib("pthread")
    BOOST_FILESYSTEM_LIB = os.findlib("boost_filesystem")
    STDCXX_FS_LIB="";

    if os.isfile("/usr/include/c++/5/experimental/filesystem") then
        STDCXX_FS_LIB = "stdc++fs";
    end

    if PTHREAD_LIB then
        print("`pthread` library found at " .. PTHREAD_LIB)
        defines { "PFS_HAVE_PTHREAD" }
        links { "pthread" }
    end

    if not STDCXX_FS_LIB then
        if BOOST_FILESYSTEM_LIB then
            print("`Boost Filesystem` library found at " .. BOOST_FILESYSTEM_LIB)
            defines { "HAVE_BOOST_FILESYSTEM" }
            links { "boost_filesystem" }
        end
    else
        print("`stdc++fs` library found")
        -- need for 11 <= C++ < 17
        defines { "HAVE_STDCXX_FS" }
        links { "stdc++fs" }
    end

-- Projects

project "pfs-test"
    include("pfs-test.gbs")

project "pfs"
    include("pfs.gbs")

include("solution-tests.gbs")
